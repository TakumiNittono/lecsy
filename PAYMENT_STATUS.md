# 課金機能の実装状況

**最終確認日**: 2026年1月28日

---

## ✅ 実装済みの機能

### 1. Stripe連携（バックエンド）

- [x] **Stripeパッケージ**: `stripe@^14.10.0` インストール済み
- [x] **Checkout Session作成API**: `/api/create-checkout-session` 実装済み
- [x] **Customer Portal API**: `/api/create-portal-session` 実装済み
- [x] **Stripe Webhook**: Edge Function実装済み（`supabase/functions/stripe-webhook`）
- [x] **サブスクリプション管理**: `subscriptions`テーブルで管理

### 2. データベース

- [x] **subscriptionsテーブル**: 実装済み
- [x] **usage_logsテーブル**: フェアリミット用に実装済み

### 3. Edge Functions

- [x] **summarize関数**: Pro状態チェック実装済み
- [x] **フェアリミット**: 日次/月次制限を実装

---

## ⚠️ 未実装・部分実装の機能

### 1. Web UI（フロントエンド）

- [ ] **課金ボタン**: LPには表示されているが、実際の課金フローは未完成の可能性
- [ ] **Pro状態表示**: ユーザーがProかどうかを表示するUI
- [ ] **サブスクリプション管理画面**: 解約・再開のUI
- [ ] **要約機能のUI**: `/app/t/[id]/summary` ページ

### 2. iOSアプリ

- [ ] **Pro状態の表示**: iOSアプリでPro機能の案内（Web誘導）
- [ ] **要約結果の表示**: iOSアプリで要約結果を読み取り専用で表示

---

## 📋 App Store提出への影響

### ✅ 問題なし

**課金機能はApp Store提出に必須ではありません。**

理由：
1. **課金はWebアプリで完結**: iOSアプリ内で直接課金しない
2. **無料機能で完動**: 録音・文字起こし・Web閲覧はすべて無料
3. **Pro機能はオプション**: AI要約は追加機能で、なくてもアプリは動作する

### App Store審査での注意点

- ✅ iOSアプリ内でStripe課金への直接誘導は規約違反
- ✅ Webアプリへの誘導は問題なし（「Open on Web」ボタンなど）
- ✅ 無料機能が完全に動作することが重要

---

## 🚀 今後の実装計画

### Phase 1: MVP（App Store提出前）

**必須ではないが、実装すると良いもの**:
- [ ] WebアプリでPro状態を表示
- [ ] 要約機能のUI（`/app/t/[id]/summary`）

**実装しなくても良いもの**:
- [ ] 課金ボタンとフロー（後で実装可能）
- [ ] サブスクリプション管理画面（後で実装可能）

### Phase 2: 収益化（App Store提出後）

**実装推奨**:
- [ ] 完全な課金フロー（Checkout → Webhook → Pro有効化）
- [ ] サブスクリプション管理画面
- [ ] iOSアプリでのPro機能案内

---

## 💡 推奨アプローチ

### App Store提出前

1. **無料機能を完璧にする**
   - 録音・文字起こし・Web同期が正常に動作
   - タイトル編集・削除が正常に動作

2. **Pro機能は後回し**
   - 課金機能は後で実装可能
   - まずは無料機能でユーザーを獲得

3. **Webアプリの準備**
   - 課金機能のバックエンドは実装済み
   - UIだけ後で追加すればOK

### App Store提出後

1. **ユーザーフィードバックを収集**
2. **Pro機能の需要を確認**
3. **課金フローを完成させる**

---

## ✅ 結論

**課金機能はWebアプリの機能で、App Store提出には必須ではありません。**

- ✅ バックエンドは実装済み（Stripe連携、Webhook、DB）
- ⚠️ フロントエンドUIは部分実装（後で完成させればOK）
- ✅ App Store提出には問題なし（無料機能で完動）

**今後の実装でも全く問題ありません！**

---

**最終更新**: 2026年1月28日
