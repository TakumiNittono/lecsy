# lecsy 実装ロードマップ

## 📋 目次

1. [フェーズ概要](#フェーズ概要)
2. [Phase 0: 環境構築](#phase-0-環境構築)
3. [Phase 1: MVP](#phase-1-mvp)
4. [Phase 2: 収益化](#phase-2-収益化)
5. [Phase 3: 差別化](#phase-3-差別化)
6. [チェックリスト](#チェックリスト)

---

## フェーズ概要

```
┌─────────────────────────────────────────────────────────────┐
│                    lecsy 開発ロードマップ                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Phase 0: 環境構築                                          │
│  ────────────────                                           │
│  • Supabase プロジェクト作成                                │
│  • Auth (Google/Apple) 設定                                 │
│  • DB + RLS 設定                                            │
│                                                             │
│           ↓                                                 │
│                                                             │
│  Phase 1: MVP                                               │
│  ────────────────                                           │
│  • iOS: 録音 → 文字起こし → 一覧/詳細                        │
│  • iOS: Save to Web                                         │
│  • Web: ログイン → 一覧 → 詳細 → コピー                      │
│                                                             │
│           ↓                                                 │
│                                                             │
│  Phase 2: 収益化                                            │
│  ────────────────                                           │
│  • Stripe 連携                                              │
│  • subscriptions 管理                                       │
│  • Edge Function: AI要約                                    │
│  • Web: Summarize / Exam Mode UI                            │
│                                                             │
│           ↓                                                 │
│                                                             │
│  Phase 3: 差別化                                            │
│  ────────────────                                           │
│  • 教室モード強化                                           │
│  • セクション分解                                           │
│  • エクスポート                                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Phase 0: 環境構築

### 目標

> Supabaseプロジェクトを作成し、認証とDBを設定する

### タスク

#### 0-1. Supabase プロジェクト作成

- [ ] Supabase ダッシュボードでプロジェクト作成
- [ ] リージョン: Northeast Asia (Tokyo)
- [ ] プロジェクト名: `lecsy`
- [ ] データベースパスワード設定

#### 0-2. 認証設定

- [ ] Google OAuth設定
  - [ ] Google Cloud Console でプロジェクト作成
  - [ ] OAuth同意画面設定
  - [ ] OAuth 2.0クライアントID作成
  - [ ] SupabaseにClient ID/Secret設定

- [ ] Apple Sign In設定
  - [ ] Apple Developer Console で Services ID 作成
  - [ ] Sign In with Apple 用キー作成
  - [ ] Supabaseに設定

- [ ] Redirect URLs設定
  - [ ] `lecsy://auth/callback` (iOS)
  - [ ] `https://lecsy.app/auth/callback` (Web)

#### 0-3. データベース設定

- [ ] テーブル作成
  - [ ] `transcripts`
  - [ ] `summaries`
  - [ ] `subscriptions`
  - [ ] `usage_logs`

- [ ] RLS有効化・ポリシー設定
  - [ ] 各テーブルのRLS有効化
  - [ ] SELECT/INSERT/UPDATE/DELETE ポリシー

- [ ] インデックス作成
  - [ ] `transcripts(user_id, created_at)`
  - [ ] `summaries(transcript_id)`

- [ ] トリガー設定
  - [ ] `updated_at` 自動更新

#### 0-4. Edge Functions 雛形

- [ ] `supabase/functions/` ディレクトリ構成
- [ ] `save-transcript` 雛形作成
- [ ] ローカル開発環境設定

### 成果物

- Supabaseプロジェクト（本番用）
- 認証フロー動作確認
- DB + RLS 完成

---

## Phase 1: MVP

### 目標

> iOS録音・文字起こし → Web閲覧の基本フローを完成させる

### iOS タスク

#### 1-1. プロジェクト基盤

- [ ] Xcodeプロジェクト作成
- [ ] Bundle ID: `com.takumiNittono.lecsy`
- [ ] SwiftUI + MVVM構成
- [ ] WhisperKit パッケージ追加
- [ ] Supabase Swift パッケージ追加

#### 1-2. 録音機能

- [ ] `RecordingService` 実装
  - [ ] マイク権限リクエスト
  - [ ] AVAudioRecorder セットアップ
  - [ ] 録音開始/停止
  - [ ] バックグラウンド録音対応
  - [ ] タイマー（ストップウォッチ）

- [ ] `RecordView` 実装
  - [ ] 録音ボタン
  - [ ] ストップウォッチ表示
  - [ ] 音声レベルメーター（オプション）

- [ ] Live Activities
  - [ ] `LecsyWidgetAttributes` 定義
  - [ ] ロック画面UI
  - [ ] Dynamic Island対応

#### 1-3. 文字起こし機能

- [ ] `TranscriptionService` 実装
  - [ ] WhisperKit モデル読み込み
  - [ ] 文字起こし実行
  - [ ] 進捗表示
  - [ ] 言語選択（自動/日本語/英語）

- [ ] モデル管理
  - [ ] ダウンロード進捗表示
  - [ ] モデル削除

#### 1-4. データ管理

- [ ] `Lecture` モデル定義
- [ ] `LectureStore` 実装
  - [ ] SQLite/CoreData 保存
  - [ ] CRUD操作
  - [ ] Web同期状態管理

- [ ] `LibraryView` 実装
  - [ ] 講義一覧表示
  - [ ] 検索機能
  - [ ] 削除機能

- [ ] `LectureDetailView` 実装
  - [ ] 全文表示
  - [ ] タイトル編集
  - [ ] コピー機能

#### 1-5. 認証 & Web保存

- [ ] `AuthService` 実装
  - [ ] Supabase Auth連携
  - [ ] Google/Apple ログイン
  - [ ] セッション管理

- [ ] `SyncService` 実装
  - [ ] Save to Web 機能
  - [ ] 再送キュー
  - [ ] 状態表示

- [ ] `SettingsView` 実装
  - [ ] アカウント情報
  - [ ] ログアウト
  - [ ] 文字起こし言語設定
  - [ ] ストレージ情報

### Web タスク

#### 1-6. プロジェクト基盤

- [ ] Next.js 14 プロジェクト作成
- [ ] TypeScript 設定
- [ ] Tailwind CSS 設定
- [ ] shadcn/ui セットアップ
- [ ] Supabase クライアント設定

#### 1-7. 認証

- [ ] ログインページ (`/login`)
- [ ] OAuth コールバック (`/auth/callback`)
- [ ] 認証ミドルウェア
- [ ] ユーザーメニュー

#### 1-8. 講義機能

- [ ] 講義一覧 (`/app`)
  - [ ] TranscriptList コンポーネント
  - [ ] 検索機能
  - [ ] ソート機能

- [ ] 講義詳細 (`/app/t/[id]`)
  - [ ] TranscriptDetail コンポーネント
  - [ ] 全文表示
  - [ ] コピー機能
  - [ ] タイトル編集
  - [ ] 削除機能

#### 1-9. LP

- [ ] ランディングページ (`/`)
  - [ ] ヒーローセクション
  - [ ] 機能紹介
  - [ ] 料金プラン
  - [ ] CTA

### Backend タスク

#### 1-10. Edge Functions

- [ ] `save-transcript` 完成
  - [ ] 認証チェック
  - [ ] バリデーション
  - [ ] DB保存
  - [ ] レスポンス

### 成果物

- iOS アプリ（録音→文字起こし→一覧→保存）
- Web アプリ（ログイン→一覧→詳細→コピー）
- 基本フロー完動

---

## Phase 2: 収益化

### 目標

> Pro課金とAI要約機能を実装し、収益化する

### タスク

#### 2-1. Stripe 設定

- [ ] Stripe アカウント作成
- [ ] 商品・価格設定
  - [ ] lecsy Pro: $2.99/month
- [ ] Webhook 設定
- [ ] Customer Portal 設定

#### 2-2. 課金API

- [ ] `/api/create-checkout-session` 実装
- [ ] `/api/create-portal-session` 実装
- [ ] Stripe Webhook Edge Function 完成

#### 2-3. Pro状態管理

- [ ] `useSubscription` フック実装
- [ ] Pro/Free 表示切り替え
- [ ] アップグレードモーダル

#### 2-4. AI要約機能

- [ ] OpenAI API 設定
- [ ] `summarize` Edge Function 完成
  - [ ] Pro状態チェック
  - [ ] フェアリミット
  - [ ] AI要約生成
  - [ ] キャッシュ保存

- [ ] Web UI
  - [ ] Summary View (`/app/t/[id]/summary`)
  - [ ] Exam Mode 表示
  - [ ] ローディング状態

#### 2-5. フェアリミット

- [ ] `usage_logs` テーブル活用
- [ ] 日次/月次カウント
- [ ] リミット超過UI

### 成果物

- Stripe課金フロー完動
- AI要約機能完動
- 収益化準備完了

---

## Phase 3: 差別化

### 目標

> 競合と差別化する機能を追加する

### タスク

#### 3-1. 教室モード強化

- [ ] ノイズ抑制設定
- [ ] マイク向きガイドUI
- [ ] 録音品質最適化

#### 3-2. セクション分解

- [ ] AI でセクション自動分割
- [ ] セクションごとの要約
- [ ] ナビゲーション機能

#### 3-3. エクスポート

- [ ] PDF エクスポート
- [ ] Markdown エクスポート
- [ ] 共有機能

#### 3-4. 用語辞書

- [ ] 講義内の専門用語抽出
- [ ] 辞書登録
- [ ] 用語説明表示

#### 3-5. iOS Pro機能表示

- [ ] iOS で要約結果表示（読み取り専用）
- [ ] Web誘導UI改善

### 成果物

- 差別化機能完成
- UX 向上

---

## チェックリスト

### リリース前チェック

#### iOS

- [ ] App Store Connect 設定
- [ ] アプリ説明文
- [ ] スクリーンショット
- [ ] プライバシーポリシーURL
- [ ] サポートURL
- [ ] TestFlight テスト

#### Web

- [ ] ドメイン設定 (lecsy.app)
- [ ] Vercel デプロイ
- [ ] 環境変数設定
- [ ] SSL確認

#### 法務

- [ ] プライバシーポリシー作成
- [ ] 利用規約作成
- [ ] 特定商取引法表記（必要に応じて）

#### セキュリティ

- [ ] RLS 全テーブル確認
- [ ] APIキー漏洩チェック
- [ ] 本番環境変数設定

### 運用準備

- [ ] エラー監視設定 (Sentry等)
- [ ] アナリティクス設定
- [ ] サポート窓口設定
- [ ] バックアップ確認

---

## 依存関係図

```
Phase 0 (環境構築)
    │
    ├── Supabase プロジェクト
    │       │
    │       ├── Auth 設定 ─────────────┐
    │       │                          │
    │       └── DB + RLS ──────────────┤
    │                                  │
    ▼                                  ▼
Phase 1 (MVP)                    Phase 1 (MVP)
iOS App                          Web App
    │                                  │
    ├── 録音機能                       ├── ログイン
    │                                  │
    ├── 文字起こし                     ├── 一覧表示
    │                                  │
    ├── ローカル保存                   ├── 詳細表示
    │                                  │
    └── Save to Web ──────────────────┴── Edge Function
                │
                ▼
          Phase 2 (収益化)
                │
    ┌───────────┼───────────┐
    │           │           │
    ▼           ▼           ▼
  Stripe    AI要約    Pro管理
    │           │           │
    └───────────┴───────────┘
                │
                ▼
          Phase 3 (差別化)
                │
    ┌───────────┼───────────┐
    │           │           │
    ▼           ▼           ▼
教室モード  エクスポート  用語辞書
```

---

## 優先順位マトリクス

| 機能 | 重要度 | 緊急度 | Phase |
|------|--------|--------|-------|
| 録音 | 高 | 高 | 1 |
| 文字起こし | 高 | 高 | 1 |
| Web保存 | 高 | 高 | 1 |
| Web閲覧 | 高 | 高 | 1 |
| Live Activities | 中 | 中 | 1 |
| 検索 | 中 | 中 | 1 |
| Stripe課金 | 高 | 中 | 2 |
| AI要約 | 高 | 中 | 2 |
| Exam Mode | 中 | 低 | 2 |
| 教室モード | 中 | 低 | 3 |
| エクスポート | 低 | 低 | 3 |
| 用語辞書 | 低 | 低 | 3 |

---

**最終更新**: 2026年1月26日
