# lecsy 要件定義書

## 📋 目次

1. [概要](#概要)
2. [ユーザーストーリー](#ユーザーストーリー)
3. [機能要件](#機能要件)
4. [非機能要件](#非機能要件)
5. [制約条件](#制約条件)

---

## 概要

### プロダクト定義

**lecsy**は以下を実現する統合学習プラットフォーム：

1. iPhoneで講義を録音
2. iPhoneでローカル文字起こし（オフラインOK / 無制限）
3. ユーザーが明示操作で「テキストだけ」Supabase DBに保存
4. Webで全文閲覧・検索・コピー（無料）
5. Pro（月$2.99）でAI要約・Exam Mode（Webで実行）

### 重要な原則

| 原則 | 説明 |
|------|------|
| 音声はサーバーに送らない | 基本原則として音声ファイルは端末内 |
| 自動同期しない | ユーザー操作のみで送信 |
| 無料でも十分使える | Web閲覧・コピーは無料 |
| 課金は「理解の速さ」に対して | AI機能に課金 |

---

## ユーザーストーリー

### US-001: 初回ユーザー（ログイン不要で開始）

**As a** 大学生
**I want to** ログインなしで録音・文字起こしができる
**So that** すぐに講義を記録できる

**受け入れ条件:**
- [ ] アプリ起動後、即座に録音開始可能
- [ ] 録音停止後、自動で文字起こし開始
- [ ] 講義詳細で全文が読める
- [ ] 完全オフラインで動作する

---

### US-002: Webに保存したいユーザー

**As a** lecsy ユーザー
**I want to** 文字起こし結果をWebに保存したい
**So that** PCやタブレットからも閲覧できる

**受け入れ条件:**
- [ ] 講義詳細から「Save to Web」ボタンを押せる
- [ ] 未ログインならログイン画面に遷移
- [ ] 成功したら「Saved to Web」状態に変わる
- [ ] 「Open on Web」でWebの該当講義へ遷移

---

### US-003: Webで閲覧するユーザー

**As a** lecsy ユーザー
**I want to** Webで講義内容を閲覧・検索・コピーしたい
**So that** レポート作成や復習に活用できる

**受け入れ条件:**
- [ ] 一覧から講義を開ける
- [ ] 全文閲覧可能
- [ ] 検索機能が使える
- [ ] テキストをコピーできる
- [ ] すべて無料で利用可能

---

### US-004: AI要約を使いたいユーザー

**As a** Pro ユーザー
**I want to** AI要約・Exam Modeを使いたい
**So that** 効率的に学習できる

**受け入れ条件:**
- [ ] Summarizeボタンで要約生成
- [ ] セクション分解された要約が表示される
- [ ] Exam Modeで重要語・Q&A・出題予想が見れる
- [ ] 結果がキャッシュされ再利用可能

---

### US-005: Proプランに加入したいユーザー

**As a** Free ユーザー
**I want to** Proプランに簡単に加入したい
**So that** AI機能を使える

**受け入れ条件:**
- [ ] Pro機能ボタン押下で課金導線に遷移
- [ ] 決済完了後、即座にPro機能が有効化
- [ ] サブスクリプション管理ができる

---

## 機能要件

### FR-001: 音声録音機能（iOS）

| ID | 要件 | 優先度 | 備考 |
|----|------|--------|------|
| FR-001-01 | リアルタイム音声録音 | P0 | AVAudioRecorder使用 |
| FR-001-02 | バックグラウンド録音 | P0 | 授業中に画面オフでも継続 |
| FR-001-03 | 録音形式: M4A (AAC) | P0 | 44.1kHz / mono |
| FR-001-04 | ストップウォッチ表示 | P1 | ミリ秒単位表示 |
| FR-001-05 | 教室モード | P2 | ノイズ抑制・入力最適化 |
| FR-001-06 | マイク向きガイド | P2 | 置き方のUI |

---

### FR-002: 文字起こし機能（iOS）

| ID | 要件 | 優先度 | 備考 |
|----|------|--------|------|
| FR-002-01 | WhisperKitによるローカル文字起こし | P0 | 完全オフライン |
| FR-002-02 | 言語選択（自動/日本語/英語） | P0 | ユーザー設定可能 |
| FR-002-03 | 進捗表示（%/残り時間） | P1 | 処理中のUX |
| FR-002-04 | モデル選択 | P2 | small/base切り替え |
| FR-002-05 | エラーハンドリング | P0 | メモリ不足等の案内 |

---

### FR-003: ローカルデータ管理（iOS）

| ID | 要件 | 優先度 | 備考 |
|----|------|--------|------|
| FR-003-01 | 講義データのローカル保存 | P0 | SQLite/CoreData |
| FR-003-02 | 講義一覧表示 | P0 | ファイル名・時間・日付 |
| FR-003-03 | 講義詳細表示 | P0 | 全文閲覧 |
| FR-003-04 | 講義削除 | P0 | ファイルも削除 |
| FR-003-05 | タイトル編集 | P1 | 自由編集 |

---

### FR-004: Live Activities（iOS）

| ID | 要件 | 優先度 | 備考 |
|----|------|--------|------|
| FR-004-01 | ロック画面表示 | P1 | 録音状態・時間表示 |
| FR-004-02 | Dynamic Island対応 | P1 | iPhone 14 Pro以降 |
| FR-004-03 | タップで停止 | P1 | ロック画面から操作 |

---

### FR-005: Web保存機能（iOS）

| ID | 要件 | 優先度 | 備考 |
|----|------|--------|------|
| FR-005-01 | Save to Webボタン | P0 | ユーザー操作でのみ送信 |
| FR-005-02 | ログイン必須チェック | P0 | 未ログインならログイン画面へ |
| FR-005-03 | テキストのみ送信 | P0 | 音声ファイルは送らない |
| FR-005-04 | 送信失敗時の再送キュー | P1 | オフライン対応 |
| FR-005-05 | Saved to Web状態表示 | P0 | UI反映 |
| FR-005-06 | Open on Webボタン | P0 | Webの該当ページへ遷移 |

---

### FR-006: 認証機能（iOS/Web共通）

| ID | 要件 | 優先度 | 備考 |
|----|------|--------|------|
| FR-006-01 | Googleログイン | P0 | Supabase Auth |
| FR-006-02 | Appleログイン | P0 | App Store要件 |
| FR-006-03 | ログアウト | P0 | 設定画面に配置 |
| FR-006-04 | セッション管理 | P0 | 自動更新 |

---

### FR-007: Web閲覧機能（無料）

| ID | 要件 | 優先度 | 備考 |
|----|------|--------|------|
| FR-007-01 | 講義一覧表示 | P0 | 検索バー付き |
| FR-007-02 | 講義詳細表示 | P0 | 全文閲覧 |
| FR-007-03 | 全文検索 | P0 | キーワード検索 |
| FR-007-04 | テキストコピー | P0 | 全文/選択 |
| FR-007-05 | タイトル編集 | P1 | 無料機能 |

---

### FR-008: AI機能（Pro）

| ID | 要件 | 優先度 | 備考 |
|----|------|--------|------|
| FR-008-01 | AI要約生成 | P0 | Edge Function経由 |
| FR-008-02 | セクション分解 | P0 | Heading + 1行要約 |
| FR-008-03 | Exam Mode | P0 | 重要語・Q&A・出題予想 |
| FR-008-04 | 結果キャッシュ | P1 | DB保存 |
| FR-008-05 | フェアリミット | P1 | 1日20回/月400回目安 |

---

### FR-009: 課金機能

| ID | 要件 | 優先度 | 備考 |
|----|------|--------|------|
| FR-009-01 | Proプラン購入 | P0 | $2.99/月 |
| FR-009-02 | 課金状態管理 | P0 | subscriptionsテーブル |
| FR-009-03 | 即時反映 | P0 | 課金後すぐに有効化 |
| FR-009-04 | サブスク管理 | P1 | 解約・再開 |

---

## 非機能要件

### NFR-001: セキュリティ

| ID | 要件 | 詳細 |
|----|------|------|
| NFR-001-01 | RLS必須 | 全テーブルにRow Level Security |
| NFR-001-02 | APIキー管理 | サーバー側のみで保持 |
| NFR-001-03 | AI処理はEdge Function経由 | 課金チェック含む |
| NFR-001-04 | HTTPS通信 | すべての通信を暗号化 |

---

### NFR-002: プライバシー

| ID | 要件 | 詳細 |
|----|------|------|
| NFR-002-01 | 音声は端末内 | サーバー送信しない |
| NFR-002-02 | テキストはユーザー操作時のみ送信 | 自動同期なし |
| NFR-002-03 | Privacy Policyに明記 | 法的要件対応 |
| NFR-002-04 | データ削除権 | ユーザーがデータを削除可能 |

---

### NFR-003: パフォーマンス

| ID | 要件 | 詳細 |
|----|------|------|
| NFR-003-01 | 録音開始 | 1秒以内 |
| NFR-003-02 | 文字起こし | 音声の1/3〜1/2の時間 |
| NFR-003-03 | Web全文表示 | 仮想スクロール対応 |
| NFR-003-04 | AI要約生成 | 30秒以内 |

---

### NFR-004: 可用性

| ID | 要件 | 詳細 |
|----|------|------|
| NFR-004-01 | オフライン録音 | ネットワーク不要 |
| NFR-004-02 | オフライン文字起こし | モデルダウンロード後 |
| NFR-004-03 | Supabase障害時 | iOSローカル機能は継続 |
| NFR-004-04 | 再送キュー | オフライン時の送信をキュー |

---

### NFR-005: ユーザビリティ

| ID | 要件 | 詳細 |
|----|------|------|
| NFR-005-01 | 多言語対応 | 日本語・英語UI |
| NFR-005-02 | 初回起動ガイド | オンボーディング |
| NFR-005-03 | エラー表示 | 分かりやすいメッセージ |
| NFR-005-04 | ローディング表示 | 処理中の進捗 |

---

## 制約条件

### 技術制約

| 制約 | 詳細 |
|------|------|
| iOS 17.6以上 | Live Activities・最新API使用 |
| iPhone推奨 | メモリ・処理性能のため |
| WhisperKitモデル | 初回500MBダウンロード必要 |

### ビジネス制約

| 制約 | 詳細 |
|------|------|
| App Store審査 | Appleログイン必須等 |
| 課金手数料 | App Store 15-30% / Stripe 2.9%+30¢ |

### 法的制約

| 制約 | 詳細 |
|------|------|
| GDPR/個人情報保護法 | Privacy Policy必須 |
| 利用規約 | ToS必須 |

---

**最終更新**: 2026年1月26日
